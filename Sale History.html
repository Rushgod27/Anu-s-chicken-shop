<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Sales History</title>

<style>
body{
  margin:0;
  font-family:system-ui;
  background:#f1f5f9;
}
.header{
  background:#0f172a;
  color:#fff;
  padding:16px;
  font-weight:900;
  font-size:22px;
  text-align:center;
}
.container{
  max-width:1200px;
  margin:auto;
  padding:16px;
}
.card{
  background:#fff;
  padding:16px;
  border-radius:16px;
  margin-bottom:16px;
  box-shadow:0 4px 10px rgba(0,0,0,.05);
}
.grid{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(180px,1fr));
  gap:12px;
}
.box{
  background:#f8fafc;
  padding:12px;
  border-radius:12px;
  font-weight:800;
}
.big{ font-size:18px; }
button{
  padding:8px 16px;
  border:none;
  border-radius:8px;
  background:#4f46e5;
  color:#fff;
  font-weight:700;
}
.bill{
  background:#f8fafc;
  padding:12px;
  border-radius:12px;
  margin-bottom:10px;
}
.bill-head{
  display:flex;
  justify-content:space-between;
  font-weight:800;
}
</style>
</head>

<body>

<div class="header">ğŸ“Š Sales Dashboard</div>

<div class="container">

<!-- FILTER -->
<div class="card">
  <h3>Filter Sales by Date</h3>
  <input type="date" id="fromDate">
  <input type="date" id="toDate">
  <button onclick="loadData()">Load</button>
</div>

<!-- SOLD SUMMARY -->
<div class="card">
  <h3>ğŸ”¥ Sold (Date Range)</h3>
  <div class="grid">
    <div class="box">ğŸ” Broiler Sold<br><span class="big" id="broilerSold">0</span> kg</div>
    <div class="box">ğŸ“ Country Sold<br><span class="big" id="countrySold">0</span> kg</div>
    <div class="box">ğŸ¥š Eggs Sold<br><span class="big" id="eggsSold">0</span></div>
    <div class="box">ğŸŒ¶ Masala Sold<br>â‚¹ <span class="big" id="masalaSold">0</span></div>
    <div class="box">ğŸ’° Total Sales<br>â‚¹ <span class="big" id="totalSales">0</span></div>
  </div>
</div>

<!-- CURRENT STOCK -->
<div class="card">
  <h3>ğŸ“¦ Current Stock Available (Now)</h3>
  <div class="grid">
    <div class="box">ğŸ” Broiler Left<br><span class="big" id="broilerStock">0</span> kg</div>
    <div class="box">ğŸ“ Country Left<br><span class="big" id="countryStock">0</span> kg</div>
    <div class="box">ğŸ¥š Eggs Left<br><span class="big" id="eggsStock">0</span></div>
    <div class="box">ğŸŒ¶ Masala Left<br>â‚¹ <span class="big" id="masalaStock">0</span></div>
  </div>
</div>

<!-- DETAILED LIST -->
<div class="card">
  <h3>ğŸ§¾ Bills</h3>
  <div id="billList">Loading...</div>
</div>

</div>

<script type="module">

import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-app.js";
import { getFirestore, collection, getDocs } 
from "https://www.gstatic.com/firebasejs/10.7.0/firebase-firestore.js";

initializeApp({
  apiKey:"AIzaSyComVLxo36wvogoBFEoWyea-_yESW9BIPU",
  authDomain:"anus-chicken-shop.firebaseapp.com",
  projectId:"anus-chicken-shop"
});

const db = getFirestore();

const today = new Date().toISOString().slice(0,10);
document.getElementById("fromDate").value = today;
document.getElementById("toDate").value = today;

async function loadData(){

  const from = document.getElementById("fromDate").value;
  const to   = document.getElementById("toDate").value;

  const salesSnap = await getDocs(collection(db,"sales"));
  const stockSnap = await getDocs(collection(db,"stock_entries"));

  let broiler=0,country=0,eggs=0,masala=0,total=0;

  let bills=[];

  salesSnap.forEach(d=>{
    const s = d.data();

    if(s.date >= from && s.date <= to){

      broiler += s.items?.broiler?.qty || 0;
      country += s.items?.country?.qty || 0;
      eggs    += s.items?.eggs?.qty || 0;
      masala  += s.items?.masala?.amount || 0;
      total   += s.total || 0;

      bills.push(s);
    }
  });

  // Update sold section
  broilerSold.innerText = broiler.toFixed(2);
  countrySold.innerText = country.toFixed(2);
  eggsSold.innerText    = eggs;
  masalaSold.innerText  = masala.toFixed(2);
  totalSales.innerText  = total.toFixed(2);

  // STOCK SECTION (real-time)
  let bStock=0,cStock=0,eStock=0,mStock=0;

  stockSnap.forEach(d=>{
    const s=d.data();

    if(s.type==="broiler")
      bStock += Number(s.remainingKg)||0;

    if(s.type==="country")
      cStock += Number(s.remainingKg)||0;

    if(s.type==="eggs")
      eStock += Number(s.remainingQty)||0;

    if(s.type==="masala")
      mStock += Number(s.remainingQty)||0;
  });

  broilerStock.innerText = bStock.toFixed(2);
  countryStock.innerText = cStock.toFixed(2);
  eggsStock.innerText    = eStock;
  masalaStock.innerText  = mStock.toFixed(2);

  // BILL LIST
  const container=document.getElementById("billList");

  if(bills.length===0){
    container.innerHTML="No sales found.";
    return;
  }

  container.innerHTML = bills.reverse().map(s=>`

    <div class="bill">
      <div class="bill-head">
        <span>${s.date} | ${s.payment?.toUpperCase()}</span>
        <span>â‚¹${s.total}</span>
      </div>

      ${s.items?.broiler?`ğŸ” Broiler ${s.items.broiler.qty}kg<br>`:''}
      ${s.items?.country?`ğŸ“ Country ${s.items.country.qty}kg<br>`:''}
      ${s.items?.eggs?`ğŸ¥š Eggs ${s.items.eggs.qty}<br>`:''}
      ${s.items?.masala?`ğŸŒ¶ Masala â‚¹${s.items.masala.amount}<br>`:''}
    </div>

  `).join("");

}

loadData();

</script>

</body>
</html>
