<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Sales Intelligence Dashboard</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>

/* ============================
   CORPORATE ANALYTICS THEME
============================ */

body{
  margin:0;
  font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto;
  background:linear-gradient(135deg,#eef2ff,#f8fafc);
  color:#1f2937;
}

/* HEADER */
.header{
  background:linear-gradient(135deg,#111827,#1f2937);
  color:#fff;
  padding:18px;
  font-size:24px;
  font-weight:900;
  text-align:center;
  letter-spacing:1px;
  box-shadow:0 6px 16px rgba(0,0,0,0.25);
}

.container{
  max-width:1300px;
  margin:auto;
  padding:20px;
}

/* CARD STYLE */
.card{
  background:#ffffff;
  padding:20px;
  border-radius:20px;
  margin-bottom:20px;
  box-shadow:
    0 10px 25px rgba(0,0,0,0.06),
    0 4px 8px rgba(0,0,0,0.03);
  transition:all .25s ease;
}

.card:hover{
  transform:translateY(-2px);
}

/* FILTER */
input[type="date"]{
  padding:10px 12px;
  border-radius:10px;
  border:2px solid #e5e7eb;
  font-size:14px;
  margin-right:10px;
}

button{
  padding:10px 16px;
  border:none;
  border-radius:10px;
  background:linear-gradient(135deg,#4f46e5,#6366f1);
  color:#fff;
  font-weight:700;
  cursor:pointer;
  box-shadow:0 6px 12px rgba(79,70,229,.3);
}

button:hover{
  transform:translateY(-2px);
}

/* GRID KPI */
.grid{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(190px,1fr));
  gap:16px;
}

.kpi{
  background:linear-gradient(135deg,#f8fafc,#ffffff);
  padding:16px;
  border-radius:16px;
  font-weight:700;
  box-shadow:0 6px 14px rgba(0,0,0,0.05);
}

.kpi-title{
  font-size:13px;
  color:#6b7280;
  margin-bottom:6px;
}

.kpi-value{
  font-size:20px;
  font-weight:900;
}

canvas{
  margin-top:20px;
}

.bill{
  background:#f9fafb;
  padding:14px;
  border-radius:14px;
  margin-bottom:12px;
  border-left:6px solid #4f46e5;
}

.bill-head{
  display:flex;
  justify-content:space-between;
  font-weight:800;
  margin-bottom:6px;
}

</style>
</head>

<body>

<div class="header">ðŸ“Š Anuâ€™s Chicken Shop â€“ Intelligence Dashboard</div>

<div class="container">

<!-- FILTER -->
<div class="card">
  <h3>Date Range Filter</h3>
  <input type="date" id="fromDate">
  <input type="date" id="toDate">
  <button onclick="loadData()">Load</button>
</div>

<!-- KPIs -->
<div class="card">
  <h3>Executive Summary</h3>
  <div class="grid">
    <div class="kpi"><div class="kpi-title">Total Sales</div><div class="kpi-value">â‚¹ <span id="totalSales">0</span></div></div>
    <div class="kpi"><div class="kpi-title">Total Cost</div><div class="kpi-value">â‚¹ <span id="totalCost">0</span></div></div>
    <div class="kpi"><div class="kpi-title">Total Profit</div><div class="kpi-value">â‚¹ <span id="totalProfit">0</span></div></div>
    <div class="kpi"><div class="kpi-title">Profit %</div><div class="kpi-value"><span id="profitPercent">0</span>%</div></div>
    <div class="kpi"><div class="kpi-title">Total Bills</div><div class="kpi-value"><span id="totalBills">0</span></div></div>
    <div class="kpi"><div class="kpi-title">Avg Bill Value</div><div class="kpi-value">â‚¹ <span id="avgBill">0</span></div></div>
    <div class="kpi"><div class="kpi-title">Avg Profit/Bill</div><div class="kpi-value">â‚¹ <span id="avgProfit">0</span></div></div>
    <div class="kpi"><div class="kpi-title">Best Product</div><div class="kpi-value"><span id="bestProduct">-</span></div></div>
  </div>
</div>

<!-- CHARTS -->
<div class="card">
  <h3>Sales & Profit Trend</h3>
  <canvas id="salesChart"></canvas>
  <canvas id="profitChart"></canvas>
</div>

<div class="card">
  <h3>Product Profit Contribution</h3>
  <canvas id="productPie"></canvas>
</div>

<!-- BILL LIST -->
<div class="card">
  <h3>Bills</h3>
  <div id="billList">Loading...</div>
</div>

</div>

<script type="module">

import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-app.js";
import { getFirestore, collection, query, where, getDocs } 
from "https://www.gstatic.com/firebasejs/10.7.0/firebase-firestore.js";

initializeApp({
  apiKey:"AIzaSyComVLxo36wvogoBFEoWyea-_yESW9BIPU",
  authDomain:"anus-chicken-shop.firebaseapp.com",
  projectId:"anus-chicken-shop"
});

const db = getFirestore();

function getToday(){
  const n=new Date();
  return n.getFullYear()+"-"+String(n.getMonth()+1).padStart(2,"0")+"-"+String(n.getDate()).padStart(2,"0");
}

document.getElementById("fromDate").value=getToday();
document.getElementById("toDate").value=getToday();

async function loadData(){

  const from=new Date(document.getElementById("fromDate").value+"T00:00:00");
  const to=new Date(document.getElementById("toDate").value+"T23:59:59");

  const q=query(collection(db,"sales"),
    where("createdAt",">=",from),
    where("createdAt","<=",to)
  );

  const snap=await getDocs(q);

  let totalSales=0,totalCost=0,totalProfit=0,totalBills=0;
  let broilerProfit=0,countryProfit=0,eggProfit=0,masalaProfit=0;
  let daily={};
  let bills=[];

  snap.forEach(d=>{
    const s=d.data();
    totalSales+=s.total||0;
    totalCost+=s.totalCost||0;
    totalProfit+=s.profit||0;
    totalBills++;

    const dt=s.createdAt?.toDate();
    if(dt){
      const key=dt.toISOString().slice(0,10);
      if(!daily[key])daily[key]={sales:0,profit:0};
      daily[key].sales+=s.total||0;
      daily[key].profit+=s.profit||0;
    }

    if(s.items?.broiler) broilerProfit+=s.items.broiler.amount - s.items.broiler.cost;
    if(s.items?.country) countryProfit+=s.items.country.amount - s.items.country.cost;
    if(s.items?.eggs) eggProfit+=s.items.eggs.amount - s.items.eggs.cost;
    if(s.items?.masala) masalaProfit+=s.items.masala.amount - s.items.masala.cost;

    bills.push(s);
  });

  const profitPercent=totalSales? (totalProfit/totalSales*100):0;
  const avgBill=totalBills? (totalSales/totalBills):0;
  const avgProfit=totalBills? (totalProfit/totalBills):0;

  const productProfits={
    Broiler:broilerProfit,
    Country:countryProfit,
    Eggs:eggProfit,
    Masala:masalaProfit
  };

  const best=Object.keys(productProfits)
    .reduce((a,b)=>productProfits[a]>productProfits[b]?a:b);

  totalSalesEl.innerText=totalSales.toFixed(2);
  totalCostEl.innerText=totalCost.toFixed(2);
  totalProfitEl.innerText=totalProfit.toFixed(2);
  profitPercentEl.innerText=profitPercent.toFixed(2);
  totalBillsEl.innerText=totalBills;
  avgBillEl.innerText=avgBill.toFixed(2);
  avgProfitEl.innerText=avgProfit.toFixed(2);
  bestProductEl.innerText=best;

  // Charts
  const labels=Object.keys(daily).sort();
  const salesData=labels.map(d=>daily[d].sales);
  const profitData=labels.map(d=>daily[d].profit);

  new Chart(document.getElementById("salesChart"),{
    type:"line",
    data:{labels,datasets:[{label:"Sales â‚¹",data:salesData,borderColor:"#4f46e5"}]}
  });

  new Chart(document.getElementById("profitChart"),{
    type:"line",
    data:{labels,datasets:[{label:"Profit â‚¹",data:profitData,borderColor:"#16a34a"}]}
  });

  new Chart(document.getElementById("productPie"),{
    type:"pie",
    data:{
      labels:["Broiler","Country","Eggs","Masala"],
      datasets:[{data:[broilerProfit,countryProfit,eggProfit,masalaProfit]}]
    }
  });

  const list=document.getElementById("billList");
  if(bills.length===0){list.innerHTML="No Sales";return;}
  list.innerHTML=bills.map(s=>`
    <div class="bill">
      <div class="bill-head">
        <span>${s.createdAt?.toDate().toLocaleString()} | ${s.payment?.toUpperCase()}</span>
        <span>â‚¹${s.total}</span>
      </div>
    </div>
  `).join("");
}

const totalSalesEl=document.getElementById("totalSales");
const totalCostEl=document.getElementById("totalCost");
const totalProfitEl=document.getElementById("totalProfit");
const profitPercentEl=document.getElementById("profitPercent");
const totalBillsEl=document.getElementById("totalBills");
const avgBillEl=document.getElementById("avgBill");
const avgProfitEl=document.getElementById("avgProfit");
const bestProductEl=document.getElementById("bestProduct");

loadData();

</script>

</body>
</html>