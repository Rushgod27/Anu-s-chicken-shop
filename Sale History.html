<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Owner Dashboard â€“ Anuâ€™s Chicken Shop</title>

<style>
body{
  margin:0;
  font-family:system-ui;
  background:#f1f5f9;
}
.header{
  background:#020617;
  color:#fff;
  padding:18px;
  font-size:26px;
  font-weight:900;
  text-align:center;
}
.container{
  max-width:1300px;
  margin:auto;
  padding:16px;
}
.card{
  background:#fff;
  border-radius:18px;
  padding:18px;
  margin-bottom:16px;
  box-shadow:0 6px 14px rgba(0,0,0,.08);
}
h3{
  margin:0 0 14px;
}
.row{
  display:flex;
  gap:12px;
  flex-wrap:wrap;
}
input,button{
  padding:14px;
  font-size:16px;
  border-radius:12px;
  border:1px solid #cbd5f5;
}
button{
  background:#4f46e5;
  color:#fff;
  font-weight:900;
  border:none;
}
.grid{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(220px,1fr));
  gap:14px;
}
.box{
  background:#f8fafc;
  border-radius:14px;
  padding:16px;
}
.label{
  font-size:14px;
  color:#475569;
}
.value{
  font-size:26px;
  font-weight:900;
  margin-top:6px;
}
.good{color:#166534}
.money{color:#1d4ed8}
</style>
</head>

<body>

<div class="header">ğŸ“Š Owner Dashboard</div>

<div class="container">

<!-- DATE RANGE -->
<div class="card">
<h3>Filter Sales by Date</h3>
<div class="row">
  <input type="date" id="fromDate">
  <input type="date" id="toDate">
  <button onclick="loadDashboard()">Load</button>
</div>
</div>

<!-- SOLD -->
<div class="card">
<h3>ğŸ”¥ Sold (Date Range)</h3>
<div class="grid">
  <div class="box">
    <div class="label">ğŸ” Broiler Sold</div>
    <div class="value" id="soldBroiler">0 kg</div>
  </div>
  <div class="box">
    <div class="label">ğŸ“ Country Sold</div>
    <div class="value" id="soldCountry">0 kg</div>
  </div>
  <div class="box">
    <div class="label">ğŸ¥š Eggs Sold</div>
    <div class="value" id="soldEggs">0</div>
  </div>
  <div class="box">
    <div class="label">ğŸŒ¶ï¸ Masala Sold</div>
    <div class="value money" id="soldMasala">â‚¹0</div>
  </div>
  <div class="box">
    <div class="label">ğŸ’° Total Sales</div>
    <div class="value money" id="soldTotal">â‚¹0</div>
  </div>
</div>
</div>

<!-- CURRENT STOCK -->
<div class="card">
<h3>ğŸ“¦ Current Stock Available (Now)</h3>
<div class="grid">
  <div class="box">
    <div class="label">ğŸ” Broiler Left</div>
    <div class="value good" id="leftBroiler">0 kg</div>
  </div>
  <div class="box">
    <div class="label">ğŸ“ Country Left</div>
    <div class="value good" id="leftCountry">0 kg</div>
  </div>
  <div class="box">
    <div class="label">ğŸ¥š Eggs Left</div>
    <div class="value good" id="leftEggs">0</div>
  </div>
  <div class="box">
    <div class="label">ğŸŒ¶ï¸ Masala Left</div>
    <div class="value good" id="leftMasala">â‚¹0</div>
  </div>
</div>
</div>

</div>

<script type="module">
import { initializeApp } from
"https://www.gstatic.com/firebasejs/10.7.0/firebase-app.js";
import {
  getFirestore, collection, query, where,
  getDocs, doc, getDoc
} from
"https://www.gstatic.com/firebasejs/10.7.0/firebase-firestore.js";

initializeApp({
  apiKey:"AIzaSyComVLxo36wvogoBFEoWyea-_yESW9BIPU",
  authDomain:"anus-chicken-shop.firebaseapp.com",
  projectId:"anus-chicken-shop"
});
const db = getFirestore();

/* INIT DATES */
const today = new Date().toISOString().slice(0,10);
fromDate.value = today;
toDate.value = today;

window.onload = () => loadDashboard();

window.loadDashboard = async () => {

  /* ===== SOLD ===== */
  let broiler=0,country=0,eggs=0,masala=0,total=0;

  try{
    const q = query(
      collection(db,"sales"),
      where("date",">=",fromDate.value),
      where("date","<=",toDate.value)
    );
    const snap = await getDocs(q);

    snap.forEach(d=>{
      const v = d.data();
      const i = v.items || {};
      if(i.broiler) broiler += i.broiler.qty || 0;
      if(i.country) country += i.country.qty || 0;
      if(i.eggs)    eggs += i.eggs.qty || 0;
      if(i.masala)  masala += i.masala.amount || 0;
      total += v.total || 0;
    });
  }catch(e){
    console.warn("Create index if prompted");
  }

  soldBroiler.innerText = broiler.toFixed(2)+" kg";
  soldCountry.innerText = country.toFixed(2)+" kg";
  soldEggs.innerText = eggs;
  soldMasala.innerText = "â‚¹"+masala.toFixed(2);
  soldTotal.innerText = "â‚¹"+total.toFixed(2);

  /* ===== CURRENT STOCK ===== */
  const stockSnap = await getDoc(doc(db,"stock_current","live"));
  if(stockSnap.exists()){
    const s = stockSnap.data();
    leftBroiler.innerText =
      (s.broiler?.availableKg || 0).toFixed(2)+" kg";
    leftCountry.innerText =
      (s.country?.availableKg || 0).toFixed(2)+" kg";
    leftEggs.innerText =
      s.eggs?.available || 0;
    leftMasala.innerText =
      "â‚¹"+(s.masala?.availableAmount || 0).toFixed(2);
  }
};
</script>

</body>
</html>