<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Stock Entry ‚Äì Inventory</title>

<style>
body{
  margin:0;
  font-family:system-ui;
  background:#f1f5f9;
}
.header{
  background:#4f46e5;
  color:#fff;
  padding:16px;
  font-size:24px;
  font-weight:900;
  text-align:center;
}
.container{
  max-width:900px;
  margin:auto;
  padding:16px;
}
.card{
  background:#fff;
  padding:16px;
  border-radius:16px;
  margin-bottom:16px;
  box-shadow:0 4px 10px rgba(0,0,0,.05);
}
h3{margin-top:0}
input, select{
  width:100%;
  padding:12px;
  font-size:16px;
  margin-bottom:10px;
  border-radius:12px;
  border:1px solid #cbd5f5;
}
button{
  padding:14px;
  border:none;
  border-radius:14px;
  font-weight:800;
  cursor:pointer;
}
.primary{
  background:#16a34a;
  color:#fff;
  width:100%;
}
.row{
  display:grid;
  grid-template-columns:1fr 1fr;
  gap:10px;
}
</style>
</head>

<body>

<div class="header">üì¶ Stock Entry</div>

<div class="container">

<div class="card">
<h3>General Details</h3>
<input type="date" id="date">
<input type="text" id="supplier" placeholder="Supplier Name">
<select id="paymentStatus">
  <option value="paid">Paid (Cash/Online)</option>
  <option value="credit">Credit</option>
</select>
</div>

<div class="card">
<h3>üêî Broiler (25% Wastage)</h3>
<div class="row">
<input type="number" id="broilerKg" placeholder="Raw KG">
<input type="number" id="broilerCost" placeholder="Total Cost ‚Çπ">
</div>
</div>

<div class="card">
<h3>üêì Country (No Wastage)</h3>
<div class="row">
<input type="number" id="countryKg" placeholder="Raw KG">
<input type="number" id="countryCost" placeholder="Total Cost ‚Çπ">
</div>
</div>

<div class="card">
<h3>ü•ö Eggs (1 Tray = 30 Eggs)</h3>
<div class="row">
<input type="number" id="eggTrays" placeholder="Number of Trays">
<input type="number" id="eggCost" placeholder="Total Cost ‚Çπ">
</div>
</div>

<div class="card">
<h3>üå∂ Masala (Full Pack Only)</h3>
<input type="text" id="masalaBrand" placeholder="Brand Name">
<input type="text" id="packetSize" placeholder="Packet Size (e.g., 100g)">
<div class="row">
<input type="number" id="masalaQty" placeholder="Number of Packets">
<input type="number" id="masalaCost" placeholder="Total Cost ‚Çπ">
</div>
</div>

<button class="primary" onclick="saveStock()">SAVE STOCK ENTRY</button>

</div>


<script type="module">

import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-app.js";
import {
  getFirestore,
  collection,
  addDoc,
  serverTimestamp
} from "https://www.gstatic.com/firebasejs/10.7.0/firebase-firestore.js";

initializeApp({
  apiKey:"AIzaSyComVLxo36wvogoBFEoWyea-_yESW9BIPU",
  authDomain:"anus-chicken-shop.firebaseapp.com",
  projectId:"anus-chicken-shop"
});

const db = getFirestore();

date.value = new Date().toISOString().slice(0,10);

window.saveStock = async () => {

  const entryDate = date.value;
  const supplierName = supplier.value.trim();
  const payment = paymentStatus.value;

  if(!entryDate || !supplierName){
    alert("Date and Supplier required");
    return;
  }

  const baseData = {
    date: entryDate,
    supplier: supplierName,
    paymentStatus: payment,
    payments: [],
    status: "active",
    createdAt: serverTimestamp()
  };

  try {

    // üêî Broiler
    if(+broilerKg.value > 0 && +broilerCost.value > 0){

      const rawKg = +broilerKg.value;
      const totalCost = +broilerCost.value;

      const sellableKg = rawKg * 0.75;
      const costPerSellableKg = totalCost / sellableKg;

      await addDoc(collection(db,"stock_entries"),{
        ...baseData,
        type:"broiler",
        rawKg,
        wastagePercent:25,
        sellableKg,
        remainingKg:sellableKg,
        totalCost,
        costPerSellableKg:+costPerSellableKg.toFixed(2)
      });
    }

    // üêì Country
    if(+countryKg.value > 0 && +countryCost.value > 0){

      const rawKg = +countryKg.value;
      const totalCost = +countryCost.value;

      const costPerSellableKg = totalCost / rawKg;

      await addDoc(collection(db,"stock_entries"),{
        ...baseData,
        type:"country",
        rawKg,
        wastagePercent:0,
        sellableKg:rawKg,
        remainingKg:rawKg,
        totalCost,
        costPerSellableKg:+costPerSellableKg.toFixed(2)
      });
    }

    // ü•ö Eggs
    if(+eggTrays.value > 0 && +eggCost.value > 0){

      const trays = +eggTrays.value;
      const totalCost = +eggCost.value;

      const totalEggs = trays * 30;
      const costPerUnit = totalCost / totalEggs;

      await addDoc(collection(db,"stock_entries"),{
        ...baseData,
        type:"eggs",
        trays,
        totalEggs,
        remainingQty:totalEggs,
        totalCost,
        costPerUnit:+costPerUnit.toFixed(2)
      });
    }

    // üå∂ Masala
    if(
      masalaBrand.value &&
      +masalaQty.value > 0 &&
      +masalaCost.value > 0
    ){

      const qty = +masalaQty.value;
      const totalCost = +masalaCost.value;
      const costPerUnit = totalCost / qty;

      await addDoc(collection(db,"stock_entries"),{
        ...baseData,
        type:"masala",
        brand:masalaBrand.value.trim(),
        packetSize:packetSize.value.trim(),
        receivedQty:qty,
        remainingQty:qty,
        totalCost,
        costPerUnit:+costPerUnit.toFixed(2)
      });
    }

    alert("Stock entry saved successfully");

    location.reload();

  } catch(error){
    alert("Error saving stock: "+error.message);
  }

};

</script>

</body>
</html>
