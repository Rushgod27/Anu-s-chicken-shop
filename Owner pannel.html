<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Sales Intelligence Dashboard</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
body{
  margin:0;
  font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto;
  background:linear-gradient(135deg,#eef2ff,#f8fafc);
}

.header{
  background:linear-gradient(135deg,#111827,#1f2937);
  color:#fff;
  padding:18px;
  font-size:22px;
  font-weight:900;
  text-align:center;
}

.container{max-width:1300px;margin:auto;padding:20px}

.card{
  background:#fff;
  padding:20px;
  border-radius:18px;
  margin-bottom:20px;
  box-shadow:0 6px 18px rgba(0,0,0,0.06);
}

.grid{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(220px,1fr));
  gap:15px;
}

.kpi{
  background:#f9fafb;
  padding:14px;
  border-radius:12px;
}

.kpi-title{font-size:13px;color:#6b7280}
.kpi-value{font-size:20px;font-weight:900}

.bill{
  background:#f8fafc;
  padding:12px;
  border-radius:10px;
  margin-bottom:10px;
  border-left:4px solid #4f46e5;
}

.bill-head{
  display:flex;
  justify-content:space-between;
  font-weight:800;
}
</style>
</head>

<body>

<div class="header">ðŸ“Š Anuâ€™s Chicken Shop â€“ Business Intelligence</div>

<div class="container">

<div class="card">
  <h3>Date Range Filter</h3>
  <input type="date" id="fromDate">
  <input type="date" id="toDate">
  <button id="loadBtn">Load</button>
</div>

<div class="card">
  <h3>Executive Summary</h3>
  <div class="grid">

    <div class="kpi">
      <div class="kpi-title">Broiler (kg)</div>
      <div>Sold: <b id="broilerSold">0</b></div>
      <div>Available: <b id="broilerAvailable">0</b></div>
    </div>

    <div class="kpi">
      <div class="kpi-title">Country (kg)</div>
      <div>Sold: <b id="countrySold">0</b></div>
      <div>Available: <b id="countryAvailable">0</b></div>
    </div>

    <div class="kpi">
      <div class="kpi-title">Eggs</div>
      <div>Sold: <b id="eggSold">0</b></div>
      <div>Available: <b id="eggAvailable">0</b></div>
    </div>

    <div class="kpi">
      <div class="kpi-title">Masala</div>
      <div>Sold â‚¹: <b id="masalaSold">0</b></div>
      <div>Available: <b id="masalaAvailable">0</b></div>
    </div>

  </div>
</div>

<div class="card">
  <h3>Financial Overview</h3>
  <div class="grid">
    <div class="kpi"><div>Total Sales</div><div class="kpi-value">â‚¹ <span id="totalSales">0</span></div></div>
    <div class="kpi"><div>Total Profit</div><div class="kpi-value">â‚¹ <span id="totalProfit">0</span></div></div>
  </div>
</div>

<div class="card">
  <h3>Product Profit Contribution</h3>
  <canvas id="productPie"></canvas>
</div>

<div class="card">
  <h3>Bills</h3>
  <div id="billList">Loading...</div>
</div>

</div>

<script type="module">

import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-app.js";
import { getFirestore, collection, getDocs } 
from "https://www.gstatic.com/firebasejs/10.7.0/firebase-firestore.js";

initializeApp({
  apiKey:"AIzaSyComVLxo36wvogoBFEoWyea-_yESW9BIPU",
  authDomain:"anus-chicken-shop.firebaseapp.com",
  projectId:"anus-chicken-shop"
});

const db=getFirestore();
let productPieChart=null;

function today(){
  const d=new Date();
  return d.getFullYear()+"-"+String(d.getMonth()+1).padStart(2,"0")+"-"+String(d.getDate()).padStart(2,"0");
}

document.getElementById("fromDate").value=today();
document.getElementById("toDate").value=today();
document.getElementById("loadBtn").addEventListener("click",loadData);

async function loadData(){

  const from=document.getElementById("fromDate").value;
  const to=document.getElementById("toDate").value;

  const salesSnap=await getDocs(collection(db,"sales"));
  const stockSnap=await getDocs(collection(db,"stock_entries"));

  let totalSales=0,totalProfit=0;
  let broilerSold=0,countrySold=0,eggSold=0,masalaSold=0;
  let broilerProfit=0,countryProfit=0,eggProfit=0,masalaProfit=0;

  salesSnap.forEach(doc=>{
    const s=doc.data();
    if(!s.date) return;
    if(s.date<from || s.date>to) return;

    totalSales+=Number(s.total)||0;
    totalProfit+=Number(s.profit)||0;

    if(s.items?.broiler){
      broilerSold+=Number(s.items.broiler.qty)||0;
      broilerProfit+=Number(s.items.broiler.amount||0)-Number(s.items.broiler.cost||0);
    }

    if(s.items?.country){
      countrySold+=Number(s.items.country.qty)||0;
      countryProfit+=Number(s.items.country.amount||0)-Number(s.items.country.cost||0);
    }

    if(s.items?.eggs){
      eggSold+=Number(s.items.eggs.qty)||0;
      eggProfit+=Number(s.items.eggs.amount||0)-Number(s.items.eggs.cost||0);
    }

    if(s.items?.masala){
      masalaSold+=Number(s.items.masala.amount)||0;
      masalaProfit+=Number(s.items.masala.amount||0)-Number(s.items.masala.cost||0);
    }
  });

  let broilerAvailable=0,countryAvailable=0,eggAvailable=0,masalaAvailable=0;

  stockSnap.forEach(doc=>{
    const s=doc.data();

    if(s.type==="broiler") broilerAvailable+=Number(s.remainingKg)||0;
    if(s.type==="country") countryAvailable+=Number(s.remainingKg)||0;
    if(s.type==="eggs") eggAvailable+=Number(s.remainingQty)||0;
    if(s.type==="masala") masalaAvailable+=Number(s.remainingQty)||0;
  });

  // Update UI
  document.getElementById("totalSales").innerText=totalSales.toFixed(2);
  document.getElementById("totalProfit").innerText=totalProfit.toFixed(2);

  document.getElementById("broilerSold").innerText=broilerSold.toFixed(2);
  document.getElementById("broilerAvailable").innerText=broilerAvailable.toFixed(2);

  document.getElementById("countrySold").innerText=countrySold.toFixed(2);
  document.getElementById("countryAvailable").innerText=countryAvailable.toFixed(2);

  document.getElementById("eggSold").innerText=eggSold;
  document.getElementById("eggAvailable").innerText=eggAvailable;

  document.getElementById("masalaSold").innerText=masalaSold.toFixed(2);
  document.getElementById("masalaAvailable").innerText=masalaAvailable;

  if(productPieChart) productPieChart.destroy();

  productPieChart=new Chart(document.getElementById("productPie"),{
    type:"pie",
    data:{
      labels:["Broiler","Country","Eggs","Masala"],
      datasets:[{
        data:[broilerProfit,countryProfit,eggProfit,masalaProfit]
      }]
    }
  });

}

loadData();

</script>
</body>
</html>