<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Strategic Dashboard</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
body{margin:0;font-family:system-ui;background:linear-gradient(135deg,#eef2ff,#f8fafc);}
.header{background:#111827;color:#fff;padding:16px;font-weight:900;text-align:center;}
.container{max-width:1300px;margin:auto;padding:20px}
.card{background:#fff;padding:20px;border-radius:18px;margin-bottom:20px;box-shadow:0 6px 18px rgba(0,0,0,.08);}
.grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(260px,1fr));gap:15px}
.kpi{background:#f3f4f6;padding:14px;border-radius:12px;line-height:1.6}
.kpi-title{font-weight:800;margin-bottom:6px}
canvas{margin-top:20px}
button{padding:6px 14px;font-weight:700}
</style>
</head>
<body>

<div class="header">üìä Anu‚Äôs Chicken Shop ‚Äì Strategic Dashboard</div>

<div class="container">

<div class="card">
<h3>Date Range</h3>
<input type="date" id="fromDate">
<input type="date" id="toDate">
<button onclick="loadData()">Load</button>
</div>

<div class="card">
<h3>Executive Summary</h3>
<div class="grid">

<div class="kpi">
<div class="kpi-title">üêî Broiler</div>
Sold (Range): <span id="broilerSold">0</span> kg  
<br>
Available (End Date): <span id="broilerAvailable">0</span> kg  
<br>
Inventory ‚Çπ: <span id="broilerInventory">0</span>
</div>

<div class="kpi">
<div class="kpi-title">üêì Country</div>
Sold (Range): <span id="countrySold">0</span> kg  
<br>
Available (End Date): <span id="countryAvailable">0</span> kg  
<br>
Inventory ‚Çπ: <span id="countryInventory">0</span>
</div>

<div class="kpi">
<div class="kpi-title">ü•ö Eggs</div>
Sold (Range): <span id="eggSold">0</span>  
<br>
Available (End Date): <span id="eggAvailable">0</span>
</div>

<div class="kpi">
<div class="kpi-title">üå∂ Masala</div>
Sold ‚Çπ (Range): <span id="masalaSold">0</span>  
<br>
Available (End Date): <span id="masalaAvailable">0</span>
</div>

</div>
</div>

<div class="card">
<h3>Profit Contribution</h3>
<canvas id="pieChart"></canvas>
</div>

<div class="card">
<h3>Profit Comparison</h3>
<canvas id="barChart"></canvas>
</div>

</div>

<script type="module">

import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-app.js";
import { getFirestore, collection, getDocs } 
from "https://www.gstatic.com/firebasejs/10.7.0/firebase-firestore.js";

initializeApp({
  apiKey:"YOUR_API_KEY",
  authDomain:"anus-chicken-shop.firebaseapp.com",
  projectId:"anus-chicken-shop"
});

const db=getFirestore();
let pieChart=null, barChart=null;

function today(){
 const d=new Date();
 return d.getFullYear()+"-"+String(d.getMonth()+1).padStart(2,"0")+"-"+String(d.getDate()).padStart(2,"0");
}

fromDate.value=today();
toDate.value=today();

window.loadData=async function(){

const from=fromDate.value;
const to=toDate.value;

const salesSnap=await getDocs(collection(db,"sales"));
const stockSnap=await getDocs(collection(db,"stock_entries"));

let rangeStats={
 broiler:{sold:0,profit:0},
 country:{sold:0,profit:0},
 eggs:{sold:0,profit:0},
 masala:{sold:0,profit:0}
};

let cumulativeSales={
 broiler:0,
 country:0,
 eggs:0
};

// SALES
salesSnap.forEach(doc=>{
 const s=doc.data();
 if(!s.date) return;

 if(s.date <= to){
  if(s.items?.broiler) cumulativeSales.broiler+=Number(s.items.broiler.qty)||0;
  if(s.items?.country) cumulativeSales.country+=Number(s.items.country.qty)||0;
  if(s.items?.eggs) cumulativeSales.eggs+=Number(s.items.eggs.qty)||0;
 }

 if(s.date>=from && s.date<=to){
  if(s.items?.broiler){
   rangeStats.broiler.sold+=Number(s.items.broiler.qty)||0;
   rangeStats.broiler.profit+=Number(s.items.broiler.amount||0)-Number(s.items.broiler.cost||0);
  }
  if(s.items?.country){
   rangeStats.country.sold+=Number(s.items.country.qty)||0;
   rangeStats.country.profit+=Number(s.items.country.amount||0)-Number(s.items.country.cost||0);
  }
  if(s.items?.eggs){
   rangeStats.eggs.sold+=Number(s.items.eggs.qty)||0;
   rangeStats.eggs.profit+=Number(s.items.eggs.amount||0)-Number(s.items.eggs.cost||0);
  }
  if(s.items?.masala){
   rangeStats.masala.sold+=Number(s.items.masala.amount)||0;
   rangeStats.masala.profit+=Number(s.items.masala.amount||0)-Number(s.items.masala.cost||0);
  }
 }
});

// PURCHASES (using date string)
let purchases={
 broiler:{qty:0,cost:0},
 country:{qty:0,cost:0},
 eggs:{qty:0},
 masala:{qty:0}
};

stockSnap.forEach(doc=>{
 const s=doc.data();
 if(!s.date) return;
 if(s.date > to) return;

 if(s.type==="broiler"){
  purchases.broiler.qty+=Number(s.sellableKg||0);
  purchases.broiler.cost+=Number(s.totalCost||0);
 }

 if(s.type==="country"){
  purchases.country.qty+=Number(s.sellableKg||0);
  purchases.country.cost+=Number(s.totalCost||0);
 }

 if(s.type==="eggs"){
  purchases.eggs.qty+=Number(s.receivedQty||0);
 }

 if(s.type==="masala"){
  purchases.masala.qty+=Number(s.receivedQty||0);
 }

});

const broilerAvailable=purchases.broiler.qty-cumulativeSales.broiler;
const countryAvailable=purchases.country.qty-cumulativeSales.country;
const eggAvailable=purchases.eggs.qty-cumulativeSales.eggs;
const masalaAvailable=purchases.masala.qty;

const broilerAvg=purchases.broiler.qty? purchases.broiler.cost/purchases.broiler.qty:0;
const countryAvg=purchases.country.qty? purchases.country.cost/purchases.country.qty:0;

broilerSold.innerText=rangeStats.broiler.sold.toFixed(2);
countrySold.innerText=rangeStats.country.sold.toFixed(2);
eggSold.innerText=rangeStats.eggs.sold;
masalaSold.innerText=rangeStats.masala.sold.toFixed(2);

broilerAvailable.innerText=broilerAvailable.toFixed(2);
countryAvailable.innerText=countryAvailable.toFixed(2);
eggAvailable.innerText=eggAvailable;
masalaAvailable.innerText=masalaAvailable;

broilerInventory.innerText=(broilerAvailable*broilerAvg).toFixed(2);
countryInventory.innerText=(countryAvailable*countryAvg).toFixed(2);

if(pieChart) pieChart.destroy();
if(barChart) barChart.destroy();

pieChart=new Chart(document.getElementById("pieChart"),{
 type:"pie",
 data:{
  labels:["Broiler","Country","Eggs","Masala"],
  datasets:[{
   data:[
    rangeStats.broiler.profit,
    rangeStats.country.profit,
    rangeStats.eggs.profit,
    rangeStats.masala.profit
   ]
  }]
 }
});

barChart=new Chart(document.getElementById("barChart"),{
 type:"bar",
 data:{
  labels:["Broiler","Country","Eggs","Masala"],
  datasets:[{
   label:"Profit ‚Çπ",
   data:[
    rangeStats.broiler.profit,
    rangeStats.country.profit,
    rangeStats.eggs.profit,
    rangeStats.masala.profit
   ]
  }]
 }
});

};

loadData();

</script>
</body>
</html>